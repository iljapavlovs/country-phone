language: java
jdk:
- openjdk8
services:
- docker
env:
  global:
  - secure: mlbpMcHavWXxx5hhXvBDcYT5IsX+n7ecUrE6O/ka8irvUAxApzfdcHT8mb+Q2hSVbBSJasZeT8BWCCq0vPQs9U/lzstEBmeuUzZepGy/dTdqwk8qi7OC+YLGGCPtVFDaJmE9MWDB4LjkWLk0jDZo54MDp52h5T9e8Ped3yJMic+S1HOKWcFooTTpC+8rctfNBkuWKXzxeA+sghsL+pR4Te0AcK4Rc+p4fJoXdgHkcCh1onlHjlGNk9iphdlz4PgNJS15gXpPaclsTLAWZ/SVwWPpdv8k8gqFzXvCngh2uJwbQYSFxlE5YyyQynIPitWp4GPO1PmBblQzkyufo+bLoQCtuQk9TcK0rrH2Sm1xW/uV06PBPfxMp7lQx8taPznl+nHnJMSt2E01VUGkIuK8NlcJdaMULva/LW9Wslta6MKi0aLmkeEyWBwmnbv4JAS+jbNULJQNfZU9SD51nZHj3KmfJa0kAXk3D4Ewc1T8PJKuuTbJk1ItPNSfCi59w/1ipfL7sIhjg8so4GBkPXjGZn5jYzlVgL2txj7fAWmD1se735R0PO99m/7ysoQbAG3FcIzE+JZmMqfyloHhTVrPbDbaEcq+xTiY8j1Gy1ocmC6cBRb33dDToi0CMhHlv8+gKADaIAUikFJkIi+FWykzPZWR0RdHw+JPhO/qjClioBc=
  - secure: AJfFY38lvv3dGo3x8p32EGBr0MJDgRj4v/mUFw5JI0hLAjtKfxX0TG8U0xeqCJ8XokRZvwb1hNskAmI8t8+sQKFSUcc+e0wzX5+WqVo79nQsNRihyVWHswCx4UWmmuW+Bpj9T/UtCsd+h98QjTI90KqJnj8a51+unozNLcp7qwX2NxdiaIoIa7lvk9f4Cw1bKKhq+8g9aNMWDM4sQsNH9qTU5stn4TUgnwcDoJDhVyvZmThPQPFvv+A3Mtw8yZnUmEdWHveoPhtTYj3ACrPwxOBbade1e63xMO7un5YWHK3g7QnSwWQCqAxbth8wvBLdWkEfFa28shatSb2RRXL1f4Y0XJwvCGmUvGsUdPuoaooX+mMfvc4rZzWOYC8q8HyaJql47/AB7eG4ztE6aAgOXVQcSFhwM6Q3f1xVupo8WFdCGxpGDYESiIMJwjaPH+q/hCBMvuAbaa13zLHHG6iMAD+MSB/ENEhP7yJUvs30rQ9EDMuBxgWJYumsUV8NF0gk4mD076bd2cPIzL0oAjc70yWhYdWMuhjVFWSQqFVms/SQSTU4DY4OERS7ub56/peH4Si1BSuUHLEYZjxfTaH2QzNz2OsB71pHQd0zkwxI+CLs/clJP19XUlHNnfwzzUL9sG0K5W1bu07j/IgDEa6cRD6ll8Zl0GocOAw1nxctY5Q=
  - secure: iZjSpNkdnWT6vJSLaj0dzl7BQOphlpU8mLRJDnlws4grnNBy6FWawuWdvrg7Hy+bwaOjsOfaqGcpd/I+zN1/OyayitP2oP4eLldRk25CMS0AciBV6CL7yJqq4lvZYgM//0uirHuAuPLKfNDkLpVA17e6DCD+lDbPM8V5pH3B9kVO7j4LNXVR5tBexgLuUbrftr4KYaADmtatT05TEjQRYOIq3zVOAQzQADoITSXsfXQx7OktKg/qI44b8nCvZOipqEKTVx3o6HZ7YnHVaYfwaI27qAEXGwnal9hCn4uIMemkK0Pp0jWSa7nnOWJZGllewpWYEFrMJDBEGtpocnZTkLenp8yAzukTF8vPjQAJvPQYgt4Bt/zLna60a3o/XrfhkMMnQYtpRiTXezEs14fVhNTEJ44nUV6fWS/cVOX37nhrRUa4SpOoWTn1qJGRSaQRLgYPjzDpymFfiQXddnpyIzXGzbd3AWNcXB3Rv9Xinb1dydJkm4g1Lc1/6xiSWFYBhBeLD2VlnzLaSgrTlTrGytsI7V1RNWofo8qsta88BApI8Kl2WcI5/KI05c+oed4ghiM34iV4/h0zejcbgY9MuEBBhxdjN/BiMX5ockWpvYV1jYC0zLbhqZg+XFrMwd1qymPmk0GgH44rtisnEETVMPw2fw5i0uVAroEH5828v+4=
  - secure: kFzYfqEXplostHLJhZY4Kq7ozkMM07rcO4m8izReGtLJY1Wa/BM9KoZC198QCZi/V+ZmYtAvoJdTMIw7dGGXBvwUlmBCAmbPsyCqHgRhF0agnfd9L084EKpqtnkXRKkahXpDrSal/d/X98Vk8d1bq5FVXmtMcceT6r46WL5nUnl8DBt/1mdgkTLPWi4ppGWQLFJh5lpzDPchAoJcniLp3cFl0i57UZvoOHQiRNOSixlPYYZdHHWR+0kTzAPrsYydDWPByNLpyxdyS2/LTxXwalaScLUHzvQWhcrLIyiOIxoGP93eJ1frlAxzX7QbrC/F7Ene04dGaklkrosqmX+RBI1ecyWVSlG3iTlk0rKY74IqNDwHM+TIAaG7gDaq+lr5HAIgcOjd74M/PZZJSi9Qavk37LBZur3TgXb0H0MegvujQBjJq2O2sFmcK0uEW6UvSeolSV2TJ22ZKCJqTIBk9eylU/Q1UrBv7w1+ZWtfyrE9/FTH7y76Toroj2wRtvCoVyqA/2EtmCEdYkucS5wZSxN7HC+PX70dS1Fc3z7F6o4/9Y42aB593u0CDIXqcG64J521Cl00+T9qK6vBEh+y05FvVnjhmXnTWCC2hTqCZUXbao2nttUgKucwgmdKABLA8kh5tLGHEGXquQUoxyuQ8tobgR1IxkV1DsKp4xZ4FuU=
  - secure: loNh0CXoxBvOonxZpbkbsqXmAABJOubx23TLAX72nZKB9JTfgeycMePAlw5nqyA+07XFfLlZfxtvxzYbhx+KLFnOV0A8G1GMa9EzD91rJpAPAIcladKcI8aT7qEVqLwzUkHsS81DRdkhFIi5HrlGJfluU/fvVj2IRkFiR43AtOYpe3rM3JLh5ShG+qrUj6FfmLEyftDjU1bgu6HgP4O6oAzbCtCM2IWjtxlb/jVkKjPGhlxirLQ92qJaskNDH3hQWCUsmMW7md3ksQcUUEP7Jmuf2kl9nFJ3x1JujrlVaZZf94w9fE2e3DlKyrFv6/B3jvX5kERlnclLFEU/KSyZX7T97JXN5jLzQ9LYFFdRFg6lv74L/cOe5Uq5GJbEUHJn3gYA+VaWdsCFZzo+PuubTYRCudaCw7vLWvAvG4D9sWWHdM1Hq7D9kA/jI8bj1sPEjljdxQWmS0nt6NgK2eM/TJl4sPyXwc/U2ZQtbBjYriwWknURvFiasYcGX7obCZmSznwf0OpIwWCgnRUEnn83xGGYzeABaKj3hViDbgovQxmHPuLui8QmSwXZeD4bIZdA4fK8OloVHuxLs0LiSbi2+v0xRZSh26VAECNxu4cIwF4684+82c9PkX8SidKZPh5OVDwlvViehN0iOr4BANzDCWxA/EbCMiNCjntsqVAk2ow=
before_install:
- docker pull openjdk:8-jdk-alpine
script:
- "./gradlew clean test"
- "./gradlew integrationTest"
after_success:
- export COMMIT=${TRAVIS_COMMIT::7}
- export TAG=`if [ ! -z "$TRAVIS_TAG" ]; then echo "$TRAVIS_TAG"; else echo "$TRAVIS_BRANCH--$COMMIT";
  fi`
- echo "$DOCKER_PASS" | docker login -u "$DOCKER_USERNAME" --password-stdin
- docker-compose build
- docker tag $IMAGE_NAME:latest $IMAGE_NAME:$TAG
- docker push $IMAGE_NAME:$TAG
- export TITLE="$IMAGE_NAME:$TAG is built properly and pushed to Dockerhub"
- export TIMESTAMP=`date`
- export GIT_LOG=`git log -1 --pretty=%B $COMMIT`
- export TEXT="[build version] $TAG<br />[datetime] $TIMESTAMP<br />[changelog] $GIT_LOG<br/>"



# Allow Travis to help deploy the app on Heroku
deploy:
  provider: heroku
  api-key:
    secure: "$HEROKU_API_KEY"
  app: country-phone
  on:
    tags: true
    repo: "$IMAGE_NAME"